# line-pm

**LINE Bot × Gemini AI × Notion** を使った次世代プロジェクト管理システム

LINEでメッセージを送るだけで、最新のGemini 2.0 Flash-Lite AIが内容を解析し、Notionに構造化されたプロジェクトページを自動作成します。

## ✨ 2025年最新機能

- **🤖 Gemini 2.0 Flash-Lite**: 最新・最安・最速AIモデル搭載
- **📋 自動WBS生成**: 4フェーズ構造の実行可能なアクションプラン
- **🎯 空欄対応**: 推測できない項目は空欄で正確な情報管理
- **⚡ 高速処理**: フリーティア制限大幅改善（RPM: 30、TPM: 1M）
- **🛡️ 重複防止**: 3段階チェックによる重複処理防止

## 🌟 主な機能

### 📱 LINE Bot統合
- LINEから直接プロジェクトを登録
- 詳細な進捗情報をリアルタイム通知
- WBS案の即座提示

### 🤖 AI分析 (Gemini 2.0 Flash-Lite)
- 自然言語での高精度テキスト解析
- 4軸分類システムによる自動プロパティ推測
- 推測禁止ルールによる正確性重視

### 📊 Notion連携
- 分析結果を基にNotionデータベースに自動ページ作成
- Markdown対応の構造化コンテンツ
- チェックリスト・見出し・番号付きリスト自動変換

### 🔄 重複防止システム
- Event ID、Message Hash、Emergency Key の3段階チェック
- 5分間のキャッシュによる重複処理防止
- 自動クリーンアップ機能

## 🚀 動作フロー

```
1. LINE でメッセージ送信
   ↓
2. Gemini 2.0 Flash-Lite で高精度分析
   ↓  
3. 4軸分類システムで自動分類
   ↓
4. Notion に構造化ページ作成
   ↓
5. WBS案付き詳細結果をLINEに通知
```

## 🛠️ 技術スタック

- **バックエンド**: Node.js + Express.js
- **AI分析**: Google Gemini 2.0 Flash-Lite API
- **データベース**: Notion API
- **メッセージング**: LINE Bot SDK
- **デプロイ**: Railway
- **監視**: 詳細ログ・エラーハンドリング

## 📚 プロジェクト分類体系（4軸）

このシステムは独自の4軸分類でプロジェクトを管理します：

### 🏷️ 種別 (6分類)
- **📋 企画・戦略** - 将来の方向性を決める、計画を立てる業務
- **🛠 制作・開発** - 具体的な成果物・コンテンツを作る業務
- **🚀 実行・運用** - 施策実行、日常業務オペレーション
- **👥 マネジメント** - 人・チーム・リソース管理
- **📊 分析・改善** - データ分析、振り返り、改善検討
- **📝 その他・雑務** - 上記に当てはまらない業務

### 📦 成果物 (6分類)
- **📄 資料・企画書** - 戦略書、企画書、提案書、計画書
- **🎨 コンテンツ** - LP、動画、記事、SNS投稿、メルマガ  
- **📈 レポート** - 分析結果、効果測定、業績報告
- **⚙ システム・ツール** - Webサイト、アプリ、業務ツール
- **📋 ルール・仕組み** - 業務フロー、マニュアル、制度設計
- **🎯 その他** - 上記に当てはまらない成果物

### 🎚️ レベル (5分類)
- **🏛 戦略レベル** - 3ヶ月以上、事業・組織全体に大きな影響
- **📂 プロジェクト** - 1-3ヶ月、複数人のチーム
- **✅ タスク** - 1-4週間、個人または少数で完結
- **⚡ アクション** - 1日-1週間、すぐできる作業
- **💭 メモ** - 思考整理、アイデア出し

### 📊 ステータス (常に「📥 未分類」で統一)
- **📥 未分類** - システム登録直後の状態（AI自動設定）

Gemini 2.0 Flash-Lite AIがテキストを解析し、これらの軸で自動分類することで、一貫性のあるプロジェクト管理を実現します。

📋 **詳細**: [プロジェクト分類体系の詳細はこちら](./docs/classification-system.md)

## 📋 必要な環境変数

以下の環境変数を設定してください：

```env
# LINE Bot設定
LINE_CHANNEL_ACCESS_TOKEN=your_line_channel_access_token
LINE_CHANNEL_SECRET=your_line_channel_secret

# Google Gemini AI設定  
GEMINI_API_KEY=your_gemini_api_key

# Notion設定
NOTION_API_KEY=your_notion_api_key
NOTION_DATABASE_ID=your_notion_database_id

# サーバー設定（オプション）
PORT=8080
NODE_ENV=production
```

## 🔧 セットアップ手順

### 1. リポジトリのクローン

```bash
git clone https://github.com/t-hamamura/line-pm.git
cd line-pm
```

### 2. 依存関係のインストール

```bash
npm install
```

### 3. 環境変数の設定

`.env` ファイルを作成し、上記の環境変数を設定

### 4. LINE Bot の設定

1. [LINE Developers Console](https://developers.line.biz/) でBot作成
2. Channel Access Token と Channel Secret を取得
3. Webhook URL を設定: `https://your-domain.com/webhook`

### 5. Google Gemini API の設定

1. [Google AI Studio](https://makersuite.google.com/) でAPI キー取得
2. `GEMINI_API_KEY` に設定
3. **推奨**: Gemini 2.0 Flash-Lite は最新・最安・最速モデルです

### 6. Notion の設定

1. [Notion Developers](https://developers.notion.com/) でインテグレーション作成
2. API キーを取得
3. データベースをインテグレーションと共有
4. データベースIDを取得

### 7. アプリケーションの起動

```bash
npm start
```

## 📊 Notion データベース構造

システムが想定しているデータベースのプロパティ：

| プロパティ名 | 型 | 説明 | 自動設定 |
|------------|-----|------|----------|
| Name | タイトル | プロジェクト名 | ✅ 入力テキストそのまま |
| ステータス | セレクト | 常に「📥 未分類」 | ✅ 固定値 |
| 種別 | セレクト | 業務の性質 | ⚠️ 推測可能時のみ |
| 優先度 | セレクト | 緊急度 | ⚠️ 明記時のみ |
| 成果物 | セレクト | 最終アウトプット | ⚠️ 推測可能時のみ |
| レベル | セレクト | 規模 | ⚠️ 推測可能時のみ |
| 案件 | セレクト | 関連プロジェクト | ⚠️ キーワード検出時のみ |
| 担当者 | セレクト | 担当者名 | ⚠️ 明記時のみ |
| 期限 | 日付 | 完了予定日 | ⚠️ 日付記載時のみ |
| 記入日 | 日付 | 登録日 | ✅ 自動設定（今日） |

**重要**: ⚠️マークの項目は、テキストから明確に読み取れない場合は空欄のまま登録されます。

## 💬 使用方法

### 1. LINE Botを友だち追加

### 2. プロジェクトの内容をメッセージで送信

#### 例1: 基本的なプロジェクト
```
新商品のマーケティング戦略を来月までに策定する
```

#### 例2: 詳細な指定
```
マーケティング戦略を12月20日まで緊急で作成
```

### 3. システムの応答例

```
✅ プロジェクトを登録しました！

📝 タイトル: マーケティング戦略を12月20日まで緊急で作成
📋 ステータス: 📥 未分類
⭐ 優先度: 🔥 緊急
🏷️ 種別: 📋 企画・戦略
🎚️ レベル: 📂 プロジェクト
📦 成果物: 📄 資料・企画書
👤 担当者: (空欄)
🗓️ 期限: 2023-12-20
💼 案件: (空欄)

📋 WBS案:
1. 市場調査の実施
2. 競合分析の実行  
3. 顧客ニーズの調査
4. 戦略フレームワークの選定
5. SWOT分析の実施
6. 戦略オプションの検討

🔗 詳細: https://notion.so/...
```

## 🎯 AI分析の特徴

### 高精度な分類 (Gemini 2.0 Flash-Lite)
- **文脈理解**: 単語だけでなく文脈から判断
- **推測禁止**: 明確でない情報は無理に設定しない
- **正確性重視**: 確実な情報のみを自動設定

### WBS自動生成
- **4フェーズ構造**: 調査・計画・実行・完了
- **実行可能**: 具体的なアクションアイテム
- **チェックリスト**: Notionでタスク管理可能

### 柔軟な入力対応
- **自然言語**: 話し言葉での入力OK
- **簡潔な表現**: 「LP作成」などの短文でも分析
- **複合タスク**: 複数の要素を含む複雑なプロジェクトも対応

## 🔍 API エンドポイント

- `GET /` - ヘルスチェック
- `POST /webhook` - LINE Webhook
- `POST /clear-cache` - キャッシュクリア（デバッグ用）

## 🛡️ セキュリティ機能

- **署名検証**: LINE Webhookの署名を検証
- **重複防止**: メッセージの重複処理を防止（3段階チェック）
  - Event ID チェック
  - Message Hash チェック  
  - Emergency Key チェック
- **エラーハンドリング**: 適切なエラー処理とログ出力
- **タイムアウト制御**: 8秒タイムアウトでレスポンス保証

## 📈 ログとモニタリング

### ログの種類
- `[EVENT]` - イベント処理
- `[GEMINI]` - AI分析（🤖 Gemini 2.0 Flash-Lite）
- `[NOTION]` - Notion操作
- `[WEBHOOK]` - Webhook処理
- `[EMERGENCY]` - 重複防止
- `[ERROR]` - エラー

### ヘルスチェック
```bash
curl https://your-domain.com/
```

応答例：
```json
{
  "status": "OK",
  "timestamp": "2023-12-06T10:30:00.000Z",
  "services": {
    "projectAnalyzer": true,
    "notionService": true
  },
  "cache": {
    "processedEvents": 15
  }
}
```

## 🚀 デプロイ

### Railway でのデプロイ（推奨）

1. [Railway](https://railway.app/) でアカウント作成
2. GitHubリポジトリを接続
3. 環境変数を設定
4. 自動デプロイが開始

### 手動デプロイ

```bash
# 本番環境での起動
NODE_ENV=production npm start
```

## ⚡ パフォーマンス

### Gemini 2.0 Flash-Lite の優位性
| 項目 | 旧モデル | **Gemini 2.0 Flash-Lite** | 改善率 |
|------|----------|---------------------------|--------|
| **RPM制限** | 15 | **30** | **+100%** |
| **TPM制限** | 250K | **1M** | **+300%** |
| **RPD制限** | 500 | **1,500** | **+200%** |
| **レスポンス** | 3-8秒 | **1-3秒** | **50-70%高速化** |
| **コスト** | 無料 | **無料** | **変わらず** |

### システム最適化
- **タイムアウト制御**: 8秒で確実にレスポンス
- **フォールバック機能**: API障害時の自動回復  
- **インテリジェント キャッシュ**: 5分間の重複防止
- **定期クリーンアップ**: メモリ使用量最適化

## 🎯 活用シーン

### 個人利用
- 日々のタスク管理
- アイデアの整理と構造化
- プロジェクトの進捗管理

### チーム利用  
- プロジェクトの一元管理
- 業務の標準化
- 進捗の可視化

### 組織利用
- 部門横断プロジェクトの管理
- 業務効率の分析
- リソース配分の最適化

## 🤝 開発に参加する

### 開発環境のセットアップ

```bash
# 開発モードで起動
npm run dev
```

### コードスタイル

- JavaScript ES6+
- エラーハンドリングの徹底
- 詳細なログ出力
- 関数の単一責任原則

### 貢献方法

1. Issuesで議論
2. Forkしてfeatureブランチ作成
3. Pull Request作成
4. レビュー後マージ

## 📚 ドキュメント

- [プロジェクト分類体系](./docs/classification-system.md) - 4軸分類システムの詳細
- [WBS生成機能](./docs/wbs-generation.md) - WBS自動生成の仕組み
- [Geminiアップグレードガイド](./docs/gemini-upgrade-guide.md) - AIモデル更新手順
- [トラブルシューティング](./docs/troubleshooting.md) - よくある問題と解決方法
- [API仕様書](./docs/api.md) - 詳細なAPI仕様
- [システム設計書](./docs/architecture.md) - アーキテクチャの詳細

## 🔄 更新履歴

### v2.0.0 (2025-06)
- ✨ Gemini 2.0 Flash-Lite アップグレード
- ✨ WBS自動生成機能追加
- ✨ 空欄対応機能実装
- ⚡ パフォーマンス大幅向上（50-70%高速化）
- 🛡️ 重複防止機能強化

### v1.1.0 (2025-06)
- 🔧 LINE返信メッセージ書式改善
- 🔧 項目順序最適化
- 🔧 期限表示追加

### v1.0.0 (2024)
- 🎉 初回リリース
- 📱 LINE Bot機能
- 🤖 Gemini AI連携
- 📊 Notion自動登録

## 📝 ライセンス

このプロジェクトは MIT ライセンスの下で公開されています。

## 🐛 バグ報告・機能要望

[Issues](https://github.com/t-hamamura/line-pm/issues) でバグ報告や機能要望をお送りください。

## 📞 サポート

質問やサポートが必要な場合は、Issuesまたは開発者までお気軽にお問い合わせください。

---

**🎉 プロジェクト管理をもっと簡単に、もっと効率的に！**  
**⚡ 最新のGemini 2.0 Flash-Lite AIで、次世代のプロジェクト管理を体験してください。**
